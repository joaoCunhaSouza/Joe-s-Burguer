{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ combo.name }}</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  font-family: 'Roboto', Arial, sans-serif;
}
body {
  background-color: #f5f5f5;
  color: #333;
  line-height: 1.5;
  overflow-x: hidden;
}
header {
  background-color: #ff4d4d;
  color: white;
  padding: 16px 0;
  text-align: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
header h1 {
  font-size: 1.5rem;
  font-weight: 700;
}
.main-container {
  width: 100%;
  max-width: 100vw;
}
.carousel-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  margin: 20px 0;
  padding: 0 10px;
}
.carousel-slot {
  flex: 0 0 30%;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100px;
}
.carousel-item {
  text-align: center;
  cursor: pointer;
  opacity: 0.5;
  transform: scale(0.8);
  transition: all 0.4s ease-in-out;
}
.carousel-item.active {

  opacity: 1;
  transform: scale(1.2);
  transition: all 0.4s ease-in-out;
}
.carousel-item img {
  max-width: 70px;
}
.item-label {
  margin-top: 5px;
  font-size: 0.8rem;
  color: #ff4d4d;
  font-weight: 600;
}
.product-content {
  padding: 0 15px;
}
.product-header {
  text-align: center;
  margin-bottom: 15px;
}
.product-header h2 {
  font-size: 1.3rem;
  color: #ff4d4d;
}
.product-header p {
  color: #666;
  font-size: 0.9rem;
}
.ingredient-price {
  font-size: 1rem;
  color: #ff4d4d;
  font-weight: 600;
  display: block;
  margin-top: 6px;
}
.quantity-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 15px 0;
}
.quantity-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background-color: #ff4d4d;
  color: white;
  border: none;
  font-size: 1.1rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.quantity-btn:active {
  background-color: #e63c3c;
}
.quantity-value {
  min-width: 30px;
  text-align: center;
  font-weight: 600;
  font-size: 1.1rem;
  margin: 0 10px;
}
.order-summary {
  padding: 15px;
  background-color: #f5f5f5;
}
.order-total {
  background-color: white;
  border-radius: 10px;
  padding: 16px;
  text-align: center;
  font-size: 1.3rem;
  font-weight: 700;
  color: #ff4d4d;
}
.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
.action-btn {
  flex: 1;
  padding: 14px;
  border-radius: 8px;
  font-weight: 600;
  text-align: center;
  border: none;
  cursor: pointer;
}
.confirm-btn {
  background-color: #ff4d4d;
  color: white;
}
</style>
</head>
<body>
<header>
  <h1>{{ combo.name }}</h1>
</header>

<div class="main-container">
  <div class="carousel-container">
    <div class="carousel-slot" id="slot-left"></div>
    <div class="carousel-slot" id="slot-center"></div>
    <div class="carousel-slot" id="slot-right"></div>
  </div>

  <div class="product-content">
    {% for product in products %}
    <div id="product-{{ forloop.counter0 }}-content" {% if not forloop.first %}style="display:none;"{% endif %}>
      <div class="product-header">
        <h2>{{ product.name }}</h2>
        <p>{{ product.description }}</p>
        <span class="ingredient-price">R$ {{ product.price|floatformat:2 }}</span>
      </div>
      <div class="quantity-controls">
        <button class="quantity-btn decrease">-</button>
        <span class="quantity-value" id="product-quantity-{{ product.id }}">
          {% if product.name == "Hamb√∫rguer" or product.name == "Refrigerante" %}1{% else %}0{% endif %}
        </span>
        <button class="quantity-btn increase">+</button>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="order-summary">
  <div class="order-total" id="order-total">Total: R$ 0,00</div>
  <div class="action-buttons">
    <button class="action-btn confirm-btn">Finalizar Pedido</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const products = [
    {% for product in products %}
      {
        index: {{ forloop.counter0 }},
        id: "{{ product.id }}",
        name: "{{ product.name|escapejs }}",
        price: {{ product.price|floatformat:2 }},
        img: "{{ product.image.url }}"
      },
    {% endfor %}
  ];

  const slots = {
    left: document.getElementById('slot-left'),
    center: document.getElementById('slot-center'),
    right: document.getElementById('slot-right')
  };

  const contents = {};
  {% for product in products %}
    contents['product-{{ forloop.counter0 }}'] = document.getElementById('product-{{ forloop.counter0 }}-content');
  {% endfor %}

  let activeIndex = 0;

  function renderCarousel() {
    const prev = products[activeIndex - 1];
    const active = products[activeIndex];
    const next = products[activeIndex + 1];

    slots.left.innerHTML = prev ? createItem(prev, false) : '';
    slots.center.innerHTML = createItem(active, true);
    slots.right.innerHTML = next ? createItem(next, false) : '';

    updateContent();
  }

  function createItem(product, isActive) {
    return `
      <div class="carousel-item ${isActive ? 'active' : ''}" data-index="${product.index}">
        <img src="${product.img}" alt="${product.name}">
        <div class="item-label">${product.name}</div>
      </div>`;
  }

  function updateContent() {
    Object.values(contents).forEach(div => div.style.display = 'none');
    const key = 'product-' + activeIndex;
    if(contents[key]) contents[key].style.display = 'block';
  }

  // Initial render
  renderCarousel();

  // Handle click
  document.querySelectorAll('.carousel-slot').forEach(slot => {
    slot.addEventListener('click', function(e) {
      const item = e.target.closest('.carousel-item');
      if (item) {
        activeIndex = parseInt(item.dataset.index);
        renderCarousel();
      }
    });
  });

  // Quantity update
  const prices = {};
  products.forEach(p => {
    prices['product-quantity-' + p.id] = p.price;
  });

  function updateOrderTotal() {
    let total = 0;
    for (const id in prices) {
      const qty = parseInt(document.getElementById(id).textContent);
      total += qty * prices[id];
    }
    document.getElementById('order-total').textContent = `Total: R$ ${total.toFixed(2).replace('.', ',')}`;
  }

  document.querySelectorAll('.quantity-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const span = this.parentElement.querySelector('.quantity-value');
      let qty = parseInt(span.textContent);
      if (this.classList.contains('increase')) qty++;
      else if (qty > 0) qty--;
      span.textContent = qty;
      updateOrderTotal();
    });
  });

  updateOrderTotal();
});
</script>
</body>
</html>
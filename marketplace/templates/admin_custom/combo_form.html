{% extends 'admin_custom/base.html' %}

{% block title %}{{ action }} Combo - Admin{% endblock %}

{% block content %}
<div class="admin-card">
    <h2>{{ action }} Combo</h2>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="name">Nome do Combo *</label>
            <input 
                type="text" 
                name="name" 
                id="name"
                class="form-control" 
                value="{{ combo.name|default:'' }}"
                placeholder="Ex: Combo Duplo, Combo Família, etc"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="price">Preço (R$) *</label>
            <input 
                type="number" 
                name="price" 
                id="price"
                class="form-control" 
                step="0.01"
                value="{{ combo.price|default:'' }}"
                required
            />
        </div>
        
        <div class="form-group">
            <label>Produtos do Combo *</label>
            <div class="checkbox-list">
                {% for product in products %}
                <div class="checkbox-item">
                    <label>
                        <input 
                            type="checkbox" 
                            name="products" 
                            value="{{ product.id }}"
                            {% if combo and product in combo.products.all %}checked{% endif %}
                        />
                        <span>{{ product.name }} - R$ {{ product.price }}</span>
                    </label>
                </div>
                {% empty %}
                <p style="color: #7f8c8d; text-align: center; padding: 1rem;">
                    Nenhum produto disponível. 
                    <a href="{% url 'admin_product_add' %}">Adicionar produto</a>
                </p>
                {% endfor %}
            </div>
            <small style="color: #7f8c8d; margin-top: 0.5rem; display: block;">
                Selecione um ou mais produtos que farão parte deste combo
            </small>
        </div>
        
        <div class="form-group">
            <label for="image">Imagem {% if not combo %}*{% endif %}</label>
            <input 
                type="file" 
                name="image" 
                id="image"
                class="form-control"
                accept="image/*"
                {% if not combo %}required{% endif %}
                onchange="previewImage(event)"
            />
            {% if combo.image %}
            <img src="{{ combo.image.url }}" alt="{{ combo.name }}" class="image-preview" id="preview">
            <p style="margin-top: 0.5rem; color: #7f8c8d; font-size: 0.875rem;">Deixe em branco para manter a imagem atual</p>
            {% else %}
            <img id="preview" class="image-preview" style="display: none;">
            {% endif %}
        </div>
        
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-success">Salvar</button>
            <a href="{% url 'admin_combo_list' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
function previewImage(event) {
    const preview = document.getElementById('preview');
    const file = event.target.files[0];
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}

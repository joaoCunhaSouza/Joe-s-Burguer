{% extends 'admin_custom/base.html' %}

{% block title %}{{ action }} Subproduto - Admin{% endblock %}

{% block content %}
<div class="admin-card">
    <h2>{{ action }} Subproduto</h2>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="product">Produto Principal *</label>
            <select name="product" id="product" class="form-control" required>
                <option value="">Selecione um produto</option>
                {% for prod in products %}
                <option value="{{ prod.id }}" {% if subproduct.product.id == prod.id %}selected{% endif %}>
                    {{ prod.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="name">Nome do Subproduto *</label>
            <input 
                type="text" 
                name="name" 
                id="name"
                class="form-control" 
                value="{{ subproduct.name|default:'' }}"
                placeholder="Ex: Coca-Cola 350ml, Queijo Extra, etc"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="price">Preço Adicional (R$) *</label>
            <input 
                type="number" 
                name="price" 
                id="price"
                class="form-control" 
                step="0.01"
                value="{{ subproduct.price|default:'0.00' }}"
                placeholder="0.00 para itens sem custo adicional"
                required
            />
            <small style="color: #7f8c8d; margin-top: 0.25rem; display: block;">
                Use 0.00 para ingredientes padrão que não têm custo adicional
            </small>
        </div>
        
        <div class="form-group">
            <label for="description">Descrição</label>
            <textarea 
                name="description" 
                id="description"
                class="form-control"
                placeholder="Descrição opcional do subproduto"
            >{{ subproduct.description|default:'' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="image">Imagem (opcional)</label>
            <input 
                type="file" 
                name="image" 
                id="image"
                class="form-control"
                accept="image/*"
                onchange="previewImage(event)"
            />
            {% if subproduct.image %}
            <img src="{{ subproduct.image.url }}" alt="{{ subproduct.name }}" class="image-preview" id="preview">
            <p style="margin-top: 0.5rem; color: #7f8c8d; font-size: 0.875rem;">Deixe em branco para manter a imagem atual</p>
            {% else %}
            <img id="preview" class="image-preview" style="display: none;">
            {% endif %}
        </div>
        
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-success">Salvar</button>
            <a href="{% url 'admin_subproduct_list' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
function previewImage(event) {
    const preview = document.getElementById('preview');
    const file = event.target.files[0];
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}

{% extends 'base.html' %}
{% block title %}Token Login{% endblock %}
{% block content %}
<div style="max-width:420px;margin:40px auto;padding:24px;background:#fff;border-radius:12px;">
  <h2>Entrar via Token</h2>
  <p>Informe o token fornecido pelo sistema para fazer login no dashboard offline.</p>
  <form id="tokenForm">
    <label for="token">Token</label>
    <input id="token" name="token" type="text" style="width:100%;padding:8px;margin:8px 0;border:1px solid #ddd;border-radius:8px;" />
    <button type="submit" style="background:#ff4d4d;color:#fff;border:none;padding:10px 14px;border-radius:8px;">Entrar</button>
  </form>
  <div id="message" style="margin-top:10px;color:#c00"></div>
</div>
{% endblock %}
{% block scripts %}
<script>
document.getElementById('tokenForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const token = document.getElementById('token').value.trim();
  if(!token) return;
  try{
    const res = await fetch('', {method:'POST', body: JSON.stringify({token}), headers:{'Content-Type':'application/json'}});
    const data = await res.json();
    if(res.ok && data.redirect){
      window.location = data.redirect;
    } else {
      document.getElementById('message').textContent = data.detail || data.error || 'Erro ao autenticar';
    }
  }catch(err){
    document.getElementById('message').textContent = 'Erro de rede ou servidor.';
  }
});
</script>
{% endblock %}